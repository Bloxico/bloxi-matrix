system: chain
subsystem: Store
description: Generic implementation of the Store interface
features:
  - name: Load
    behaviors:
      - id: CHAIN_STORE_LOAD_001
        description: |
          Rebuilds the Store's caches by traversing backwards.
          Does not validate state transitions.
      - id: CHAIN_STORE_LOAD_002
        description: |
          If error occurs while loading latest known head from the disk, 
          return error.
      - id: CHAIN_STORE_LOAD_003
        description: |
          If error occurs while getting tipset identified by parent's cid block,
          return error.
    ###
  - name: Load tipset metadata
    behaviors:
      - id: CHAIN_STORE_LOAD_METADATA_001
        description: |
          Given a tipset,
          loads tipset status (state root and receipts)
      - id: CHAIN_STORE_LOAD_METADATA_002
        description: |
          If there is an error getting object from store providing key,
          return error.
      - id: CHAIN_STORE_LOAD_METADATA_003
        description: |
          If there is an error unmarshalling bytes into TSState,
          return error.
    ###
  - name: Tipsets iterator
    behaviors:
      - id: CHAIN_STORE_ITERATOR_001
        description: |
          Given a tipset to start from, and a number,
          return an iterator over tipsets from head to genesis
    ###
  - name: Get block
    behaviors:
      - id: CHAIN_STORE_GET_BLOCK_001
        description: |
          Given a blockID, returns the block indentified by cid.
      - id: CHAIN_STORE_GET_BLOCK_002
        description: |
          If there is an error getting block from ilpd storage,
          return error.
    ###
  - name: Get tipset
    behaviors:
      - id: CHAIN_STORE_GET_TIPSET_001
        description: |
          Given a tipset key, returns the tipset identified by cid.
      - id: CHAIN_STORE_GET_TIPSET_002
        description: |
          If the key is empty,
          return current head tipset cids.
      - id: CHAIN_STORE_GET_TIPSET_003
        description: |
          If the tipset is present in the cache,
          return it.
      - id: CHAIN_STORE_GET_TIPSET_004
        description: |
          If there is an error getting block from store,
          while iterating throu collection of cids,
          return an erorr.
    ###
  - name: Get tipset by height
    behaviors:
      - id: CHAIN_STORE_GET_TIPSET_BY_HEIGHT_001
        description: |
          Given a tipset, an epoch, and a prev flag,
          look back and return a tipset at the specified epoch.
      - id: CHAIN_STORE_GET_TIPSET_BY_HEIGHT_002
        description: |
          If the epoch is greater than the tipset's height,
          return an error.
      - id: CHAIN_STORE_GET_TIPSET_BY_HEIGHT_003
        description: |
          If an error occurs retrieving the tipset from the chain index,
          return an error.
      - id: CHAIN_STORE_GET_TIPSET_BY_HEIGHT_004
        description: |
          If an error occurs retrieving the tipset from the chain index
          (without accessing the index cache), return an error.
      ###
  - name: Get tipset state
    behaviors:
      - id: CHAIN_STORE_GET_TIPSET_STATE_001
        description: |
          Given a tipset, 
          returns the aggreagate state of the tipset identified by key
      - id: CHAIN_STORE_GET_TIPSET_STATE_002
        description: |
          If error occurs while trying to return tipsetStateRoot from tipIndex,
          return error.
      ###
  - name: Get genesis block
    behaviors:
      - id: CHAIN_STORE_GET_GENESIS_BLOCK_001
        description: |
          Returns the genesis block held by the chain store. 
  - name: Get tipset state root
    behaviors:
      - id: CHAIN_STORE_GET_TIPSET_STATE_ROOT_001
        description: |
          Returns the aggregate state root CID of the tipset identified by key
  - name: Get latest beacon entry
    behaviors:
      - id: CHAIN_STORE_GET_LATEST_BEACON_ENTRY_001
        description: |
          Given a tipset, get latest beacon from the height.
          The max find depth is 20.
      - id: CHAIN_STORE_GET_LATEST_BEACON_ENTRY_002
        description: |
          If made it back to genesis block without finding beacon entry,
          return error.
      - id: CHAIN_STORE_GET_LATEST_BEACON_ENTRY_003
        description: |
          If loading parents if failed, while searching back to latest beacon entry,
          return error.
      - id: CHAIN_STORE_GET_LATEST_BEACON_ENTRY_004
        description: |
          If no beacon entries is found in the 20 block prior to given tipset,
          return error
      